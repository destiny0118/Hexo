# 读写分离
>读写分离主要应对数据库读并发
- 部署多台数据库，选择其中的一台作为主数据库，其他的一台或者多台作为从数据库。
- 保证主数据库和从数据库之间的数据是实时同步的，这个过程也就是我们常说的**主从复制**。
- 系统将写请求交给主数据库处理，读请求交给从数据库处理。

# 分库分表
>分库分表主要解决数据库存储，避免MySQL一张表的数据量过大


## 分库
**分库** 就是将数据库中的数据分散到不同的数据库上，可以垂直分库，也可以水平分库。

**垂直分库** 就是把单一数据库按照业务进行划分，不同的业务使用不同的数据库，进而将一个数据库的压力分担到多个数据库。

**水平分库** 是把同一个表按一定规则拆分到不同的数据库中，每个库可以位于不同的服务器上，这样就实现了水平扩展，解决了单表的存储和性能瓶颈的问题。

## 分表

**分表** 就是对单表的数据进行拆分，可以是垂直拆分，也可以是水平拆分。

**垂直分表** 是对数据表列的拆分，把一张列比较多的表拆分为多张表。
**水平分表** 是对数据表行的拆分，把一张行比较多的表拆分为多张表，可以解决单一表数据量过大的问题。

水平拆分只能解决单表数据量大的问题，为了提升性能，我们通常会选择将拆分后的多张表放在不同的数据库中。也就是说，水平分表通常和水平分库同时出现。

## 分片算法
- **哈希分片**：求指定分片键的哈希，然后根据哈希值确定数据应被放置在哪个表中。哈希分片比较适合随机读写的场景，不太适合经常需要范围查询的场景。哈希分片可以使每个表的数据分布相对均匀，但对动态伸缩（例如新增一个表或者库）不友好。
- **范围分片**：按照特定的范围区间（比如时间区间、ID 区间）来分配数据，比如 将 `id` 为 `1~299999` 的记录分到第一个表， `300000~599999` 的分到第二个表。范围分片适合需要经常进行范围查找且数据分布均匀的场景，不太适合随机读写的场景（数据未被分散，容易出现热点数据的问题）。
- **映射表分片**：使用一个单独的表（称为映射表）来存储分片键和分片位置的对应关系。映射表分片策略可以支持任何类型的分片算法，如哈希分片、范围分片等。映射表分片策略是可以灵活地调整分片规则，不需要修改应用程序代码或重新分布数据。不过，这种方式需要维护额外的表，还增加了查询的开销和复杂度。
- **一致性哈希分片**：将哈希空间组织成一个环形结构，将分片键和节点（数据库或表）都映射到这个环上，然后根据顺时针的规则确定数据或请求应该分配到哪个节点上，解决了传统哈希对动态伸缩不友好的问题。
# 数据冷热分离

数据冷热分离是指根据数据的访问频率和业务重要性，将数据分为冷数据和热数据，冷数据一般存储在存储在低成本、低性能的介质中，热数据高性能存储介质中。

- 优点：热数据的查询性能得到优化（用户的绝大部分操作体验会更好）、节约成本（可以冷热数据的不同存储需求，选择对应的数据库类型和硬件配置，比如将热数据放在 SSD 上，将冷数据放在 HDD 上）
- 缺点：系统复杂性和风险增加（需要分离冷热数据，数据错误的风险增加）、统计效率低（统计的时候可能需要用到冷库的数据）。



# 数据库查询优化

- 索引优化：前缀索引优化；覆盖索引优化；主键索引最好是自增的；防止索引失效；
- SQL查询优化：避免使用SELECT *，而是选择需要的列。避免在WHERE子句中使用函数或运算，这可能会导致索引失效。使用LIMIT分页查询时，注意性能问题，可以考虑使用索引覆盖扫描或其他分页技术。
- 启用查询缓存：启用MySQL的查询缓存功能，缓存频繁查询且结果不经常变动的查询结果。注意在数据变动频繁的场景下，查询缓存可能会成为性能瓶颈，需要谨慎使用。
- 分区和分表：对大表进行分区，将数据水平分割到不同的物理区域，提高查询性能。使用分表技术，如垂直分表或水平分表，将一个大表拆分成多个小表。
    

# MySQL慢查询排查
1. **开启慢查询日志**：
- 确保MySQL的慢查询日志已经开启。通过查看`slow_query_log`和`slow_query_log_file`变量来确认。
- 如果没有开启，可以在MySQL配置文件（如`my.cnf`或`my.ini`）中设置这些变量，然后重启MySQL服务。
    
2. **分析慢查询日志**：
- 使用`mysqldumpslow`或其他慢查询日志分析工具来查看和分析慢查询日志中的条目。
- 关注查询的执行时间、锁等待时间以及被调用的次数等信息。
    
3. **使用`EXPLAIN`命令**：
- 对于日志中记录的慢查询，使用`EXPLAIN`命令来==查看查询的执行计划==。
- 分析查询是否使用了合适的索引，以及是否存在全表扫描等低效操作。
    
4. **优化查询**：
- 根据`EXPLAIN`的输出结果，优化查询语句，比如添加或修改索引。
- 避免在查询中使用`*`，而是指定需要的列。
- 减少JOIN操作的数量或复杂性，特别是在大数据集上。
- 考虑将计算密集型的操作移到应用层进行。

  
  
作者：BAT后端A师兄  
链接：[https://www.nowcoder.com/discuss/597116383192690688?sourceSSR=users](https://www.nowcoder.com/discuss/597116383192690688?sourceSSR=users)  
来源：牛客网